function render(){if(stats.update(),checkKeys(),firstPerson){camera.position.x=tractorGroup.position.x,camera.position.y=tractorGroup.position.y+6,camera.position.z=tractorGroup.position.z;var e=new THREE.Vector3;e.setFromMatrixPosition(carHeading.matrixWorld),camera.lookAt(e)}requestAnimationFrame(render),renderer.render(scene,camera)}function addSheep(){for(i=0;i<numberOfSheep;i++){var e=createSheep(),t=getRandomInt(-150,150),o=getRandomInt(-150,150);e.position.x=t,e.position.z=o,scene.add(e),sheeps.push(e)}}function removeSheep(){sheeps.forEach(function(e,t){scene.remove(e)})}function getRandomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}function createCarBody(){var e=new THREE.BoxGeometry(4,2.5,2),t=new THREE.TextureLoader,o=t.load("../assets/textures/general/old-rusty-metal.jpg"),r=new THREE.MeshPhongMaterial;r.map=o;var n=new THREE.Mesh(e,r);return n}function createDriver(){var e=new THREE.BoxGeometry(2,4,2),t=new THREE.TextureLoader,o=t.load("../assets/textures/general/old-rusty-metal.jpg"),r=new THREE.MeshPhongMaterial;r.map=o;var n=new THREE.Mesh(e,r);return n}function createCarWheel(e){var t=new THREE.TextureLoader,o=t.load("../assets/textures/general/wheel.jpg"),r=new THREE.MeshPhongMaterial;r.map=o;var n=new THREE.CylinderGeometry(e,e,1),i=new THREE.Mesh(n,r);return i.rotation.x=Math.PI/2,i}function createBackground(){var e=new THREE.PlaneGeometry(window.innerWidth,window.innerHeight,1,1),t=new THREE.TextureLoader,o=t.load("../assets/textures/general/grass.jpg"),r=new THREE.MeshPhongMaterial;r.map=o;var n=new THREE.Mesh(e,r);return n.rotation.x=-.5*Math.PI,n}function createCamera(){var e=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.1,1e3);return e.position.x=-40,e.position.y=20,e.position.z=30,e.lookAt(scene.position),e}function createRenderer(){var e=new THREE.WebGLRenderer;return e.setClearColor(15658734,1),e.setSize(window.innerWidth,window.innerHeight),e.shadowMap.enabled=!0,e}function checkKeys(){keysDown[37]&&(keysDown[38]&&(turnAngle+=.1),keysDown[40]&&(turnAngle-=.1),notTurning&&(correctl=smallWheelLeft.position.x,correctr=smallWheelRight.position.x,smallWheelLeft.position.x+=.5,smallWheelRight.position.x-=.5,turningLeft=!0,notTurning=!1),turningRight&&(smallWheelLeft.position.x+=.5,smallWheelRight.position.x-=.5,notTurning=!0,turningRight=!1)),keysDown[39]&&(keysDown[38]&&(turnAngle-=.1),keysDown[40]&&(turnAngle+=.1),notTurning&&(correctl=smallWheelLeft.position.x,correctr=smallWheelRight.position.x,smallWheelLeft.position.x-=.5,smallWheelRight.position.x+=.5,turningRight=!0,notTurning=!1),turningLeft&&(smallWheelLeft.position.x-=.5,smallWheelRight.position.x+=.5,notTurning=!0,turningLeft=!1)),keysDown[38]&&(wheelAngle+=.2,tractorGroup.position.z-=Math.sin(-turnAngle),tractorGroup.position.x-=Math.cos(-turnAngle),tractorGroup.rotation.y=turnAngle,tractorGroup.rotation.y=turnAngle,turnWheels(!0),keysDown[37]&&keysDown[39]||(smallWheelLeft.position.x=correctl,smallWheelRight.position.x=correctr,notTurning=!0,turningRight=!1,turningLeft=!1)),keysDown[40]&&(wheelAngle-=.2,tractorGroup.position.z+=Math.sin(-turnAngle),tractorGroup.position.x+=Math.cos(-turnAngle),tractorGroup.rotation.y=turnAngle,tractorGroup.rotation.y=turnAngle,turnWheels(!1),keysDown[37]&&keysDown[39]||(smallWheelLeft.position.x=correctl,smallWheelRight.position.x=correctr,notTurning=!0,turningRight=!1,turningLeft=!1))}function addControls(){var e=new dat.GUI;e.addColor(controls,"headLightColor").onChange(function(e){light1.color=new THREE.Color(e),light2.color=new THREE.Color(e),headlight1.material.color=new THREE.Color(e),headlight2.material.color=new THREE.Color(e)}),e.add(controls,"switchCamera"),e.add(controls,"numberOfSheep").min(0).max(70).step(1).onChange(function(e){removeSheep(),numberOfSheep=e,addSheep()})}function createHeadlight(){var e=new THREE.MeshBasicMaterial({color:16777215}),t=new THREE.SphereGeometry(.2),o=new THREE.Mesh(t,e);return o}function createSheep(){var e=new THREE.Object3D,t=new THREE.TextureLoader,o=t.load("../assets/textures/general/sheep.jpg"),r=new THREE.MeshPhongMaterial;r.map=o;var n=new THREE.CylinderGeometry(1,1,4),i=new THREE.Mesh(n,r);i.position.y=2.5,i.rotation.z=Math.PI/2,e.add(i);for(var a=0,s=0;11>s;s++){a+=.7;var l=new THREE.CylinderGeometry(.5,.5,4),h=new THREE.Mesh(l,r);h.position.z+=Math.sin(-a),h.position.y+=Math.cos(-a)+3,h.rotation.z=Math.PI/2,e.add(h)}var p=createLeg();p.position.x=e.position.x+1.5,p.position.y=e.position.y,p.position.z=e.position.z+.8;var d=createLeg();d.position.x=e.position.x+1.5,d.position.y=e.position.y,d.position.z=e.position.z-.8;var c=createLeg();c.position.x=e.position.x-1.5,c.position.y=e.position.y,c.position.z=e.position.z+.8;var g=createLeg();g.position.x=e.position.x-1.5,g.position.y=e.position.y,g.position.z=e.position.z-.8,e.add(p),e.add(d),e.add(c),e.add(g);var u=t.load("../assets/textures/general/sheepheadnew.jpg"),m=new THREE.MeshPhongMaterial;m.map=u;var w=new THREE.SphereGeometry(.8),y=new THREE.Mesh(w,m);return y.position.x=e.position.x-3,y.position.y=e.position.y+4,y.rotation.y=Math.PI,y.rotation.z=-.1,e.add(y),e}function createLeg(){var e=new THREE.MeshBasicMaterial({color:0}),t=new THREE.BoxGeometry(.5,4,.5),o=new THREE.Mesh(t,e);return o}function addLight(){var e=new THREE.AmbientLight(4210752);scene.add(e)}function turnWheels(e){e?wheelAngle+=.2:wheelAngle-=.2,bigWheel1.rotation.y=wheelAngle,bigWheel2.rotation.y=wheelAngle,smallWheelLeft.rotation.y=wheelAngle,smallWheelRight.rotation.y=wheelAngle}function initStats(){var e=new Stats;return e.setMode(0),e.domElement.style.position="absolute",e.domElement.style.left="0px",e.domElement.style.top="0px",window.document.getElementById("Stats-output").appendChild(e.domElement),e}var keysDown={},tractorGroupHeight=2,turningLeft=!1,turningRight=!1,correctl,correctr,notTurning=!0,wheelAngle=0,turnAngle=0,carHeading,firstPerson=!1,numberOfSheep=40,sheeps=[];window.addEventListener("keydown",function(e){keysDown[e.keyCode]=!0}),window.addEventListener("keyup",function(e){delete keysDown[e.keyCode]});var stats=initStats(),scene=new THREE.Scene,foggyAnswer=prompt("Would you like it to be a foggy day?\n(Yes or No)","Yes");"Yes"===foggyAnswer&&(scene.fog=new THREE.Fog(16777215,20,200)),addLight();var renderer=createRenderer(),background=createBackground();scene.add(background);var tractorGroup=new THREE.Object3D;scene.add(tractorGroup);var body=createCarBody();body.position.y=tractorGroupHeight,body.position.x=0,tractorGroup.add(body);var driver=createDriver();driver.position.y=tractorGroupHeight+1,driver.position.x=2,tractorGroup.add(driver);var bigWheel1=createCarWheel(2);bigWheel1.position.y=tractorGroupHeight,bigWheel1.position.x=body.position.x+2,bigWheel1.position.z=body.position.z+2,tractorGroup.add(bigWheel1);var bigWheel2=createCarWheel(2);bigWheel2.position.y=tractorGroupHeight,bigWheel2.position.x=body.position.x+2,bigWheel2.position.z=body.position.z-2,tractorGroup.add(bigWheel2);var smallWheelLeft=createCarWheel(1);smallWheelLeft.position.y=tractorGroupHeight-1,smallWheelLeft.position.x=body.position.x-2,smallWheelLeft.position.z=body.position.z+1,tractorGroup.add(smallWheelLeft);var smallWheelRight=createCarWheel(1);smallWheelRight.position.y=tractorGroupHeight-1,smallWheelRight.position.x=body.position.x-2,smallWheelRight.position.z=body.position.z-1,tractorGroup.add(smallWheelRight),correctl=smallWheelLeft.position.x,correctr=smallWheelRight.position.x,carHeading=new THREE.Object3D,carHeading.position.y=tractorGroupHeight+1,carHeading.position.x=body.position.x-10,carHeading.position.z=body.position.z,tractorGroup.add(carHeading);var light1=new THREE.SpotLight("#ffffff");light1.position.set(body.position.x-2,tractorGroupHeight+.5,body.position.z+.4),light1.castShadow=!0,light1.shadow.camera.near=2,light1.shadow.camera.far=200,light1.shadow.camera.fov=130,light1.distance=10,light1.intensity=10,light1.target=carHeading,tractorGroup.add(light1);var light2=new THREE.SpotLight("#ffffff");light2.position.set(body.position.x-2,tractorGroupHeight+.5,body.position.z-.4),light2.castShadow=!0,light2.shadow.camera.near=2,light2.shadow.camera.far=200,light2.shadow.camera.fov=130,light2.distance=10,light2.intensity=10,light2.target=carHeading,tractorGroup.add(light2);var headlight1=createHeadlight();headlight1.position.copy(light1.position),tractorGroup.add(headlight1);var headlight2=createHeadlight();headlight2.position.copy(light2.position),tractorGroup.add(headlight2),document.body.appendChild(renderer.domElement);var camera=createCamera();scene.add(camera);var controls=new function(){this.headLightColor=light1.color.getHex(),this.numberOfSheep=numberOfSheep,this.switchCamera=function(){firstPerson?(camera=createCamera(),firstPerson=!1):(camera.position.x=tractorGroup.position.x,camera.position.y=tractorGroup.position.y+6,camera.position.z=tractorGroup.position.z,camera.lookAt(carHeading.position),firstPerson=!0)}};addControls();var changeZ=.1,rotationY=.01;addSheep(),render();